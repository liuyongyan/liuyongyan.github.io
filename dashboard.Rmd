---
title: "NY NOAA Weather Data Dashboard (2008)"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: flatly
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)
```

### About This Dashboard

This dashboard demonstrates interactive data visualization techniques using weather data from New York State. The NY NOAA dataset contains over 2.5 million observations from 747 weather stations spanning 1981-2010. For demonstration purposes, this dashboard focuses exclusively on data from 2008, which provides a representative sample of 122,665 observations while ensuring fast, responsive visualizations.

```{r}
# Load and clean NY NOAA data for 2008 (122,665 observations)
data("ny_noaa")

ny_noaa_clean = ny_noaa %>%
  separate(date, into = c("year", "month", "day"), sep = "-") %>%
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  ) %>%
  filter(year == 2008) %>%  # Focus on 2008 only
  drop_na() %>%
  mutate(
    tmax = as.numeric(tmax) / 10,  # Convert tenths to degrees Celsius
    tmin = as.numeric(tmin) / 10,  # Convert tenths to degrees Celsius
    prcp = prcp / 10,              # Convert tenths to mm
    month_name = factor(month.name[month], levels = month.name)
  )
```

### Temperature and Precipitation Relationship (2008)

```{r}
temp_prcp_plot = ny_noaa_clean %>%
  filter(prcp > 0) %>%
  # 10K observations are enough to show the trend
  sample_n(10000) %>%
  plot_ly(
    x = ~tmax,
    y = ~prcp,
    type = "scatter",
    mode = "markers",
    color = ~month_name,
    colors = "Set3",
    text = ~paste("Date:", year, "-", month, "-", day,
                  "<br>Max Temp:", tmax, "°C",
                  "<br>Precipitation:", prcp, "mm"),
    hoverinfo = "text",
    marker = list(size = 5, opacity = 0.4)
  ) %>%
  layout(
    xaxis = list(title = "Maximum Temperature (°C)"),
    yaxis = list(title = "Precipitation (mm)"),
    hovermode = "closest"
  )

temp_prcp_plot
```

### Temperature Distribution by Month (2008)

```{r}
temp_box_plot = ny_noaa_clean %>%
  plot_ly(
    x = ~month_name,
    y = ~tmax,
    type = "box",
    color = ~month_name,
    colors = "Set3"
  ) %>%
  layout(
    xaxis = list(
      title = "Month",
      categoryorder = "array",
      categoryarray = month.name
    ),
    yaxis = list(title = "Maximum Temperature (°C)"),
    showlegend = FALSE
  )

temp_box_plot
```


### Total Snowfall by Month (2008)

```{r}
# First average snowfall across stations for each day (treat NA as 0), then sum by month
snow_bar = ny_noaa_clean %>%
  mutate(snow = replace_na(snow, 0)) %>%  # Treat NA as 0
  group_by(year, month, day, month_name) %>%
  summarize(
    daily_avg_snow = mean(snow),
    .groups = "drop"
  ) %>%
  group_by(month_name) %>%
  summarize(
    total_snow = sum(daily_avg_snow),
    .groups = "drop"
  ) %>%
  plot_ly(
    x = ~month_name,
    y = ~total_snow,
    type = "bar",
    marker = list(
      color = ~total_snow,
      colorscale = list(c(0, "lightblue"), c(1, "darkblue")),
      reversescale = FALSE
    ),
    text = ~paste(round(total_snow, 1), "mm"),
    hoverinfo = "text"
  ) %>%
  layout(
    xaxis = list(title = "Month"),
    yaxis = list(title = "Total Snowfall (mm)"),
    showlegend = FALSE
  )

snow_bar
```
